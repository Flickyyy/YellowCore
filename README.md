# YellowCore - Техническое Задание

## ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### Аутентификация
- пользователь может зарегистрироваться (логин/пароль)
- пользователь может войти в систему — сервер возвращает session token
- все последующие запросы содержат session token для идентификации пользователя
- пользователь может выйти из системы (logout) — token инвалидируется
- при неверных кредентиалах — доступ запрещён, выводится ошибка
- пароли хранятся на сервере в хешированном виде (SHA-256)

### Управление счетами
- пользователь может создать новый счет, указав валюту (RUB, USD, EUR)
- номер счета генерируется сервером автоматически
- начальный баланс нового счета — 0 (пополняется отдельной операцией)
- пользователь может просмотреть баланс любого своего счета
- пользователь может просмотреть список всех своих счетов
- пользователь может закрыть счет (при условии нулевого баланса и отсутствия акций, купленных с этого счета)
- система поддерживает валюты: RUB, USD, EUR

### Операции с деньгами
- пользователь может пополнить счет (симуляция — без внешнего платежа)
- пользователь может снять деньги со счета
- пользователь может перевести деньги между своими счетами
- пользователь может отправить деньги другому пользователю (по логину или номеру счета)
- при переводе между счетами в разных валютах — автоматическая конвертация по текущему курсу (exchange rate engine)
- при попытке операции, превышающей баланс — выводится ошибка
- при попытке операции с нулевой или отрицательной суммой — выводится ошибка

### История и отчеты
- пользователь может просмотреть полную историю операций по счету
- каждая запись содержит: timestamp, тип операции (deposit/withdraw/transfer_in/transfer_out/buy_stock/sell_stock), сумму, валюту, баланс после операции, контрагента (если применимо)
- пользователь может фильтровать историю по дате и типу операции

### Торговля акциями
- сервер предоставляет фиксированный набор акций: AAPL, GOOGL, TSLA, AMZN, MSFT, NFLX, META, NVDA
- котировки номинированы в USD
- котировки обновляются автоматически (price engine на сервере симулирует рыночные изменения каждые 1-3 секунды)
- пользователь может просмотреть текущие котировки всех акций
- пользователь может купить N акций по текущей рыночной цене (market order) — деньги списываются с выбранного счета (если счет не в USD — конвертация по курсу)
- пользователь может продать N акций по текущей рыночной цене — деньги зачисляются на выбранный счет
- пользователь может просмотреть свой портфель: тикер, кол-во, средняя цена покупки, текущая цена, P&L
- при нехватке средств на счете — сделка отклоняется
- при попытке продать больше акций, чем есть — сделка отклоняется
- пользователь получает push-уведомление при изменении цены акции из портфеля на ≥5% за одно обновление
- история сделок (trades) хранится отдельно от банковских операций

---

## НЕФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### Архитектура
- клиент-серверная архитектура, взаимодействие по TCP
- протокол обмена — length-prefixed JSON (4 байта длины сообщения + JSON payload)
- многопоточный сервер (Boost.Asio) + многопоточный клиент (Qt)
- сервер поддерживает двустороннюю коммуникацию: запрос-ответ + server-push (уведомления)
- разделение бизнес-логики, сетевого слоя и представления (трёхслойная архитектура)

### Многопоточность
- **Сервер**: thread pool для одновременной обработки нескольких клиентов (Boost.Asio)
- **Сервер**: критические секции защищены `std::mutex` (изменение баланса, истории, портфеля)
- **Сервер**: `std::shared_mutex` для котировок акций и курсов валют (частое чтение — редкая запись)
- **Сервер**: `std::atomic` для счетчиков, флагов и состояний без блокировок
- **Сервер**: `std::condition_variable` для price engine thread (периодическое обновление котировок)
- **Сервер**: producer-consumer очередь для push-уведомлений клиентам (изменение котировок, входящие платежи)
- **Сервер**: покупка/продажа акций атомарна относительно баланса счета (no partial execution)
- **Клиент**: сетевая коммуникация в отдельном потоке (не блокирует UI)
- **Клиент**: обновление интерфейса через Qt signals/slots (потокобезопасно)

### Надежность
- все финансовые операции атомарны (нет partial transfers / partial trades)
- при сбое соединения — операция либо завершается, либо полностью откатывается
- сервер корректно завершается (graceful shutdown): дожидается завершения активных операций
- все ошибки (сетевые, валидационные, логические) обрабатываются явно и возвращаются клиенту с понятным сообщением
- клиент корректно обрабатывает разрыв соединения и позволяет переподключиться

### Хранение данных
- данные хранятся в памяти (in-memory репозитории)
- опционально: сериализация состояния в JSON-файл при завершении сервера и загрузка при старте

### Логирование
- сервер логирует все входящие запросы и ответы (тип, пользователь, результат)
- сервер логирует старт/стоп потоков, обновления котировок и критические события
- логи выводятся в stdout с timestamp'ами

### Графический интерфейс (Qt)
- форма авторизации (вход / регистрация)
- главный экран со списком счетов и балансами
- форма для выполнения операций (пополнение, снятие, перевод)
- отображение истории операций (таблица с сортировкой)
- экран торговли акциями: таблица котировок с live-обновлением, кнопки купить/продать
- экран инвестиционного портфеля: позиции, средняя цена, текущая цена, P&L
- отображение текущих курсов валют
- отображение статуса операции (в обработке, успешно, ошибка)
- всплывающие уведомления о входящих платежах и значительных изменениях котировок

### Тестирование
- **Сервер**: unit-тесты (GoogleTest) для бизнес-логики (транзакции, валидация, торговля, конвертация)
- **Сервер**: unit-тесты на потокобезопасность (конкурентные операции, race conditions)
- **Сервер**: интеграционные тесты (client-server communication)
- **Клиент**: unit-тесты (Qt Test) для критических компонентов
- **Общее**: стресс-тесты (одновременные операции от нескольких клиентов)
- покрытие кода тестами — не менее 70%
